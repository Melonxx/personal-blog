åœ¨ ES3 å’Œæ›´æ—©çš„ç‰ˆæœ¬ä¸­ï¼ŒJavaScript æœ¬èº«è¿˜æ²¡æœ‰å¼‚æ­¥æ‰§è¡Œä»£ç çš„èƒ½åŠ›ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œå®¿ä¸»çŽ¯å¢ƒä¼ é€’ç»™ JavaScript å¼•æ“Žä¸€æ®µä»£ç ï¼Œå¼•æ“Žå°±æŠŠä»£ç ç›´æŽ¥é¡ºæ¬¡æ‰§è¡Œäº†ï¼Œè¿™ä¸ªä»»åŠ¡ä¹Ÿå°±æ˜¯å®¿ä¸»å‘èµ·çš„ä»»åŠ¡ã€‚

ä½†æ˜¯ï¼Œåœ¨ ES5 ä¹‹åŽï¼ŒJavaScript å¼•å…¥äº† Promiseï¼Œè¿™æ ·ï¼Œä¸éœ€è¦æµè§ˆå™¨çš„å®‰æŽ’ï¼ŒJavaScript å¼•æ“Žæœ¬èº«ä¹Ÿå¯ä»¥å‘èµ·ä»»åŠ¡äº†ã€‚

>ç”±äºŽæˆ‘ä»¬è¿™é‡Œä¸»è¦è®² JavaScript è¯­è¨€ï¼Œé‚£ä¹ˆé‡‡çº³ JSC å¼•æ“Žçš„æœ¯è¯­ï¼Œæˆ‘ä»¬æŠŠ**å®¿ä¸»å‘èµ·çš„ä»»åŠ¡ç§°ä¸ºå®è§‚ä»»åŠ¡**ï¼ŒæŠŠ **JavaScript å¼•æ“Žå‘èµ·çš„ä»»åŠ¡ç§°ä¸ºå¾®è§‚ä»»åŠ¡**ã€‚

# å®è§‚å’Œå¾®è§‚ä»»åŠ¡
>JavaScript å¼•æ“Žç­‰å¾…å®¿ä¸»çŽ¯å¢ƒåˆ†é…å®è§‚ä»»åŠ¡ï¼Œåœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œé€šå¸¸ç­‰å¾…çš„è¡Œä¸ºéƒ½æ˜¯ä¸€ä¸ªäº‹ä»¶å¾ªçŽ¯ï¼Œæ‰€ä»¥åœ¨ Node æœ¯è¯­ä¸­ï¼Œä¹Ÿä¼šæŠŠè¿™ä¸ªéƒ¨åˆ†ç§°ä¸ºäº‹ä»¶å¾ªçŽ¯ã€‚

è¿™é‡Œæ¯æ¬¡çš„å¾ªçŽ¯çš„è¿‡ç¨‹ï¼Œå…¶å®žéƒ½æ˜¯ä¸€ä¸ªå®è§‚ä»»åŠ¡ã€‚æˆ‘ä»¬å¯ä»¥å¤§æ¦‚ç†è§£ï¼šå®è§‚ä»»åŠ¡çš„é˜Ÿåˆ—å°±ç›¸å½“äºŽäº‹ä»¶å¾ªçŽ¯ã€‚

åœ¨å®è§‚ä»»åŠ¡ä¸­ï¼ŒJavaScript çš„ Promise è¿˜ä¼šäº§ç”Ÿå¼‚æ­¥ä»£ç ï¼ŒJavaScript å¿…é¡»ä¿è¯è¿™äº›å¼‚æ­¥ä»£ç åœ¨ä¸€ä¸ªå®è§‚ä»»åŠ¡ä¸­å®Œæˆï¼Œå› æ­¤ï¼Œæ¯ä¸ªå®è§‚ä»»åŠ¡ä¸­åˆåŒ…å«äº†ä¸€ä¸ªå¾®è§‚ä»»åŠ¡é˜Ÿåˆ—ï¼š

![](https://upload-images.jianshu.io/upload_images/5780538-10e3e4c486ba5200.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

æœ‰äº†å®è§‚ä»»åŠ¡å’Œå¾®è§‚ä»»åŠ¡æœºåˆ¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®žçŽ° JS å¼•æ“Žçº§å’Œå®¿ä¸»çº§çš„ä»»åŠ¡äº†ï¼Œä¾‹å¦‚ï¼šPromise æ°¸è¿œåœ¨é˜Ÿåˆ—å°¾éƒ¨æ·»åŠ å¾®è§‚ä»»åŠ¡ã€‚setTimeout ç­‰å®¿ä¸» APIï¼Œåˆ™ä¼šæ·»åŠ å®è§‚ä»»åŠ¡ã€‚

#### æˆ‘ä»¬æ¥çœ‹ç«¯ä»£ç 
```
    var r = new Promise(function(resolve, reject){
        console.log("a");
        resolve()
    });
    setTimeout(()=>console.log("d"), 0)
    r.then(() => console.log("c"));
    console.log("b")
```
æˆ‘ä»¬å‘çŽ°ï¼Œä¸è®ºä»£ç é¡ºåºå¦‚ä½•ï¼Œd å¿…å®šå‘ç”Ÿåœ¨ c ä¹‹åŽï¼Œå› ä¸º Promise äº§ç”Ÿçš„æ˜¯ JavaScript å¼•æ“Žå†…éƒ¨çš„å¾®ä»»åŠ¡ï¼Œè€Œ setTimeout æ˜¯æµè§ˆå™¨ APIï¼Œå®ƒäº§ç”Ÿå®ä»»åŠ¡ã€‚

ä¸ºäº†ç†è§£å¾®ä»»åŠ¡å§‹ç»ˆå…ˆäºŽä¸‹ä¸€ä¸ªå®ä»»åŠ¡ï¼Œæˆ‘ä»¬è®¾è®¡ä¸€ä¸ªå®žéªŒï¼šæ‰§è¡Œä¸€ä¸ªè€—æ—¶ 1 ç§’çš„ Promiseã€‚
```
    setTimeout(()=>console.log("d"), 0)
    var r = new Promise(function(resolve, reject){
        resolve()
    });
    r.then(() => { 
        var begin = Date.now();
        while(Date.now() - begin < 1000);
        console.log("c1") 
        new Promise(function(resolve, reject){
            resolve()
        }).then(() => console.log("c2"))
    });
```
è¿™é‡Œæˆ‘ä»¬å¼ºåˆ¶äº† 1 ç§’çš„æ‰§è¡Œè€—æ—¶ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿ä»»åŠ¡ c2 æ˜¯åœ¨ d ä¹‹åŽè¢«æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ã€‚

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿è€—æ—¶ä¸€ç§’çš„ c1 æ‰§è¡Œå®Œæ¯•ï¼Œå† enque çš„ c2ï¼Œä»ç„¶å…ˆäºŽ d æ‰§è¡Œäº†ï¼Œè¿™å¾ˆå¥½åœ°è§£é‡Šäº†å¾®ä»»åŠ¡ä¼˜å…ˆçš„åŽŸç†ã€‚

é€šè¿‡ä¸€ç³»åˆ—çš„å®žéªŒï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸€ä¸‹å¦‚ä½•åˆ†æžå¼‚æ­¥æ‰§è¡Œçš„é¡ºåºï¼š

- é¦–å…ˆæˆ‘ä»¬åˆ†æžæœ‰å¤šå°‘ä¸ªå®ä»»åŠ¡ï¼›
- åœ¨æ¯ä¸ªå®ä»»åŠ¡ä¸­ï¼Œåˆ†æžæœ‰å¤šå°‘ä¸ªå¾®ä»»åŠ¡ï¼›
- æ ¹æ®è°ƒç”¨æ¬¡åºï¼Œç¡®å®šå®ä»»åŠ¡ä¸­çš„å¾®ä»»åŠ¡æ‰§è¡Œæ¬¡åºï¼›
- æ ¹æ®å®ä»»åŠ¡çš„è§¦å‘è§„åˆ™å’Œè°ƒç”¨æ¬¡åºï¼Œç¡®å®šå®ä»»åŠ¡çš„æ‰§è¡Œæ¬¡åºï¼›
- ç¡®å®šæ•´ä¸ªé¡ºåºã€‚

#### å†çœ‹ä¸¤ä¸ªéš¾ä¸€ç‚¹çš„ðŸŒ°
```
async function t1 () {
  console.log(1)
  console.log(2)
  await Promise.resolve().then(() => console.log('t1p'))
  console.log(3)
  console.log(4)
}

async function t2() {
  console.log(5)
  console.log(6)
  await Promise.resolve().then(() => console.log('t2p'))
  console.log(7)
  console.log(8)
}

t1()
t2()

console.log('end')
```
```
async function t1 () {
  console.log(1)
  console.log(2)
  await new Promise(resolve => {
    setTimeout(() => {
      console.log('t1p')
      resolve()
    }, 1000)
  })
  await console.log(3)
  console.log(4)
}

async function t2() {
  console.log(5)
  console.log(6)
  await Promise.resolve().then(() => console.log('t2p'))
  console.log(7)
  console.log(8)
}

t1()
t2()

console.log('end')
```
> å¯¹äºŽè¿™ä¸¤ä¸ªä¾‹å­æˆ‘å¥½éš¾è§£é‡Šæ¸…æ¥šï¼Œæ€»ä¹‹å°±æ˜¯é‡åˆ° `await` å°±å¯ä»¥åƒä¸‹é¢è¿™æ ·ç†è§£ï¼š 
```
// æ­£å¸¸ä»£ç 
await Promise.resolve().then(() => console.log('t2p'))
console.log(7)
console.log(8)

// ç±»ä¼¼ç­‰ä»·äºŽ
Promise.resolve().then(() => console.log('t2p'))
  .then(() => {
    console.log(7)
    console.log(8)
})
```
