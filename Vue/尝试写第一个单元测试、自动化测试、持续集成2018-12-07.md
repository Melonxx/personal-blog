æµ‹è¯•åº“ï¼š[chai](https://www.chaijs.com/)
```js
// å®‰è£…
npm i -D chai

// å¼•å…¥
import {expect} from 'chai'
```
æ‰“åŒ…å·¥å…·ï¼š[parcel](https://parceljs.org/getting_started.html)
```
// å®‰è£…
npm i -D parcel

// åªéœ€ä¸€è¡Œä»£ç å³å¯æ‰“åŒ…ï¼Œä¸éœ€è¦ä»»ä½•é…ç½®
parcel index.html --no-cache
```
æµ‹è¯•åˆšåœ¨ `vue` å†™æŒ‰é’®ç»„ä»¶

ğŸŒ°ï¼šä¸€ä¸ªç®€å•çš„è½®å­
**button.vue**
```
<template>
  <button @click="$emit('click')">
    <svg class="icon" aria-hidden="true">
      <use :xlink:href="`#icon-${icon}`"></use>
    </svg>
    <slot></slot>
  </button>
</template>
<script>
  export default {
    props: ['icon'],
    name: 'Button'
  }
</script>
<style lang="scss">
  .icon {
    width: 1em;
    height: 1em;
  }
  button {
    padding: 10px 20px;
    font-size: 14px;
  }
</style>

```
**index.html**
```
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
  <div id="app">
    <g-button @click="click" icon="settings">è¿™æ˜¯ä¸€ä¸ªæŒ‰é’®</g-button>
  </div>
  <div id="div"></div>
  <script src="./src/index.js"></script>
  <!-- <script src="./node_modules/vue/dist/vue.min.js"></script> -->
  <!-- <script src="./button.js"></script> -->
  <!-- <script>
    new Vue({
      el: '#app'
    })
  </script> -->
</body>
</html>
```

### å•å…ƒæµ‹è¯•
å¼€å§‹ç¬¬ä¸€æ¬¡å•å…ƒæµ‹è¯•
```
import Vue from 'vue'
import Button from './button'
import {expect} from 'chai'

Vue.component('g-button', Button)
new Vue({
  el: '#app'
})

{
  const vm = Vue.extend(Button)
  const button = new vm({
    el: '#div',
    propsData: {
      icon: 'settings'
    }
  })
  const icon = button.$el.querySelector('use')
  console.log(icon)
  expect(icon.getAttribute('xlink:href')).to.eq('settings'); // æ–­è¨€è¯­å¥ã€‚
}
```

![å¤±è´¥](./images/vue-test/vue-test_(1).png)

ç¬¬ä¸€æ¬¡æµ‹è¯•å¤±è´¥ï¼Œsvgå±æ€§æ²¡å†™å…¨

æ‰€ä»¥å†è¯•ä¸€æ¬¡~

```
import Vue from 'vue'
import Button from './button'
import {expect} from 'chai'

Vue.component('g-button', Button)
new Vue({
  el: '#app'
})

{
  const vm = Vue.extend(Button)
  const button = new vm({
    el: '#div',
    propsData: {
      icon: 'settings'
    }
  })
  const icon = button.$el.querySelector('use')
  console.log(icon)
  expect(icon.getAttribute('xlink:href')).to.eq('#icon-settings'); // æ–­è¨€è¯­å¥ã€‚
}
```

![æˆåŠŸ](./images/vue-test/vue-test_(2).png)

æˆåŠŸå•¦~ï¼Œ
æµè§ˆå™¨ä¸­æ²¡æœ‰ä»»ä½•æŠ¥é”™è¯´æ˜æµ‹è¯•é€šè¿‡

ä½†æ˜¯æ¯æ¬¡éƒ½æ‰“å¼€æµè§ˆå™¨ã€åˆ·æ–°ï¼Œå®åœ¨æ˜¯éå¸¸éº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å†ç»§ç»­**è‡ªåŠ¨åŒ–æµ‹è¯•**

###è‡ªåŠ¨åŒ–æµ‹è¯•
**å·¥å…·ï¼š**
1. Karmaï¼ˆå¡ç›ï¼‰æ˜¯ä¸€ä¸ªæµ‹è¯•è¿è¡Œå™¨ï¼Œå®ƒå¯ä»¥å‘¼èµ·æµè§ˆå™¨ï¼ŒåŠ è½½æµ‹è¯•è„šæœ¬ï¼Œç„¶åè¿è¡Œæµ‹è¯•ç”¨ä¾‹
2. Mochaï¼ˆæ‘©å¡ï¼‰æ˜¯ä¸€ä¸ªå•å…ƒæµ‹è¯•æ¡†æ¶/åº“ï¼Œå®ƒå¯ä»¥ç”¨æ¥å†™æµ‹è¯•ç”¨ä¾‹
3. Sinonï¼ˆè¥¿å†œï¼‰æ˜¯ä¸€ä¸ªspy / stub / mock åº“ï¼Œç”¨ä»¥è¾…åŠ©æµ‹è¯•ï¼ˆä½¿ç”¨åæ‰èƒ½ç†è§£ï¼‰

**thenï¼š**

```
// å®‰è£…å„ç§å·¥å…·
// npm i -D karma karma-chrome-launcher karma-mocha karma-sinon-chai mocha sinon sinon-chai karma-chai karma-chai-spies // æœ€æ–°npmåŒ…ï¼Œé˜²æ­¢ç‰ˆæœ¬æŠ¥é”™ï¼Œå»ºè®®é”å®šç‰ˆæœ¬
npm i -D karma@2.0.4 karma-chrome-launcher@2.2.0 karma-mocha@1.3.0 karma-sinon-chai@1.3.4 mocha@5.2.0 sinon@6.0.1 sinon-chai@3.2.0 karma-chai@0.1.0 karma-chai-spies@0.1.4
```
åˆ›å»º `Karma` é…ç½®
```
// æ–°å»º karma.conf.jsï¼Œå†…å®¹å¦‚ä¸‹
module.exports = function (config) {
  config.set({
    // base path that will be used to resolve all patterns (eg.files, exclude)
    basePath: '',
    // frameworks to use
    // available frameworks: https://npmjs.org/browse/keyword/karma-adapter
    frameworks: ['mocha', 'sinon-chai'],
    client: {
      chai: {
        includeStack: true
      }
    },
    // list of files / patterns to load in the browser
    files: [
      'dist/**/*.test.js',
      'dist/**/*.test.css'
    ],
    // list of files / patterns to exclude
    exclude: [],
    // preprocess matching files before serving them to the browser
    // available preprocessors: https//npmjs.org/browse/keyword/karma-reporter
    preprocessors: {},
    // test results reporter to use
    // possible values: 'dots', 'progress'
    // available reporters: https://npmjs.org/browse/keyword/karma-reporter
    reporters: ['progress'],
    // web server port
    port: 9876,
    // enable / disable colors in the output (reporters and logs)
    colors: true,
    // level if logging
    // possible values: config.LOG_DISABLE || config.LOG_ERROR || config.LOG_WARN || config.LOG_INFO || config.LOG_DEBUG
    logLevel: config.LOG_INFO,
    // enable / disable watching file and executing tests whenever any file changes
    autoWatch: true,
    // start these browsers
    // available browser launchers: http://npmjs.org/browse/keyword/karma-launcher
    browsers: ['Chrome'],
    // Continuous Integration mode
    // if true, Karma captures browsers, runs the tests and exits
    singleRun: false,
    // Concurrenecy level
    // how many browser should be started simultaneous
    concurrency: Infinity
  })
}
```
åˆ›å»ºtestç›®å½•å¹¶åœ¨å…¶ç›®å½•ä¸‹åˆ›å»ºå¹¶æ›´æ”¹ `button.test.js`
```
// import {expect} from 'chai'
const expect = chai.expect
import Vue from 'vue'
import Button from '../src/button'

Vue.config.productionTip = false
Vue.config.devtools = false

describe('Button', () => {
  it('å­˜åœ¨', () => {
    expect(Button).to.be.ok //ä¸æ˜¯ undefined null 0 '' ç­‰falsyå€¼
  })
  it('å¯ä»¥è®¾ç½®icon', () => {
    const vm = Vue.extend(Button)
    const button = new vm({
      el: '#div',
      propsData: {
        icon: 'settings'
      }
    })
    const icon = button.$el.querySelector('use')
    console.log(icon)
    expect(icon.getAttribute('xlink:href')).to.equal('#icon-setting')
  })
  it('ç‚¹å‡» button è§¦å‘ click äº‹ä»¶', () => {
    const vm = Vue.extend(Button)
    const button = new vm({
      el: '#div',
      propsData: {
        icon: 'settings'
      }
    })
    const callback = sinon.fake()
    button.$on('click', callback)
    button.$el.click()
    expect(callback).to.have.been.called
  })
})
```
åˆ›å»ºæµ‹è¯•è„šæœ¬
åœ¨ `package.json` é‡Œé¢æ‰¾åˆ° `script` å¹¶æ”¹å†™é‡Œé¢çš„å†…å®¹
```
"scripts": {
    "dev-test": "parcel watch test/* --no-cache & karma start",
    "test": "parcel build test/* --no-cache --no-minify & karma start --single-run"
  }
```

å‡†å¤‡å®Œæ¯•ï¼Œå¼€å§‹è·‘æˆ‘ä»¬çš„ä»£ç 
```
// è¿™è¡Œå‘½ä»¤ä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨å¹¶æµ‹è¯•
npm run test
// æˆ–è€… npm run dev-test // æŒç»­æ‰“åŒ…
```
å½“ç”¨ä¾‹å…¨éƒ¨æˆåŠŸæ—¶ï¼š

![æˆåŠŸ~](./images/vue-test/vue-test_(3).png)

å½“æœ‰ç”¨ä¾‹å¤±è´¥æ—¶ï¼Œç»ˆç«¯ä¼šæç¤ºæŠ¥é”™ï¼š

![å¤±è´¥](./images/vue-test/vue-test_(4).png)

>æ›´å¤šæµ‹è¯•è¯­å¥è¯·å‚è€ƒ [chaiå®˜æ–¹API](https://www.chaijs.com/guide/styles/#expect)


<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>

**ä¸­é€”é‡åˆ°çš„æŠ¥é”™~**

![image.png](./images/vue-test/vue-test_(5).png)

åœ¨ `package.json` æ·»åŠ å¦‚ä¸‹ï¼š
```
"alias": {
    "vue": "./node_modules/vue/dist/vue.common.js"
  }
```

### æŒç»­é›†æˆ
è¯´åˆ°æ‡’ï¼Œä¸€å‘æ˜¯ç¨‹åºå‘˜çš„ä¼˜è‰¯ä¼ ç»Ÿ~

ç›®å‰æ¯”è¾ƒæµè¡Œçš„æ˜¯ `TravisCi`(å…è´¹) å’Œ `circleCi`(æ”¶è´¹ï¼ŒåŠŸèƒ½å¼ºå¤§)
>[é˜®ä¸€å³°çš„Travisæ•™ç¨‹](http://www.ruanyifeng.com/blog/2017/12/travis_ci_tutorial.html)

é¦–å…ˆæˆ‘ä»¬ç»§ç»­åœ¨æ ¹ç›®å½•åˆ›å»ºæ–‡ä»¶ `.travis.yml`

å†…å®¹å¦‚ä¸‹ï¼š
```
language: node_js # ä½¿ç”¨node_jsè¿›è¡Œæµ‹è¯•
node_js: # node_jsç‰ˆæœ¬å·
  - "8"
  - "9"
  - "10"
addons: # æ’ä»¶
  chrome: stable # è°·æ­Œæµè§ˆå™¨ç¨³å®šç‰ˆ
sudo: required
before_script:
  - "sudo chown root /opt/google/chrome/chrome-sandbox"
  - "sudo chmod 4755 /opt/google/chrome/chrome-sandbox"
```

then:
æˆ‘ä»¬å‰å» [Travis](https://travis-ci.org/) å®˜æ–¹ç½‘ç«™ï¼Œå¹¶ä½¿ç”¨ `GitHub` å¸å·å…³è”ç™»é™†ï¼Œå¹¶æ‰¾åˆ°åˆšåˆšçš„æµ‹è¯•é¡¹ç›®ï¼Œç„¶åå¼€å¯

![åªéœ€ç‚¹ä¸€ä¸‹è¿™ä¸ªæŒ‰é’®](./images/vue-test/vue-test_(6).png)
è¿”å›é¦–é¡µï¼Œæˆ‘ä»¬å°±èƒ½çœ‹åˆ°å·²ç»åœ¨æµ‹è¯•å•¦~

![å¼€å§‹å•¦](./images/vue-test/vue-test_(7).png)

ä½†æ˜¯ï¼Œæˆ‘ä»¬åˆæŠ¥é”™äº† =ã€‚=

![error](./images/vue-test/vue-test_(8).png)

æŠ¥é”™å¹¶ä¸å¯æ€•ï¼Œç¿»æ¥è¦†å»åªèƒ½æƒ³åˆ°è¿”å› `Karma` çš„é…ç½®ï¼Œæ”¹ä¸€ä¸‹æµè§ˆå™¨è®¾ç½®
```
// start these browsers
// available browser launchers: http://npmjs.org/browse/keyword/karma-launcher
browsers: ['ChromeHeadless'],
```

ç”±äºæˆ‘ä»¬æ¥å…¥äº† `GitHub` æ‰€ä»¥ï¼Œåœ¨æˆ‘ä»¬æäº¤ä¹‹åï¼Œ `Travis` å°±ä¼šæ£€æµ‹åˆ°æ–‡ä»¶æ”¹å˜å¹¶è‡ªåŠ¨æµ‹è¯•~

>å½“ Travis ä»»åŠ¡çŠ¶æ€æ”¹å˜ï¼ˆå¤±è´¥æˆ–æˆåŠŸï¼‰éƒ½ä¼šå‘ä½ çš„é‚®ç®±é‡Œå‘ä¸€å°é‚®ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹¶ä¸ç”¨ä¸€ç›´æ‰“å¼€ä»–çš„ç½‘é¡µ



 


